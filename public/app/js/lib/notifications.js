define(["castrato","window","settings"],function(i,n,o){var t,e,c,f,s,u=!0,a=!1,d=function(){return performance.now()||Date.now()},r=function(){u=!0},l=function(){u=!1},m=function(){clearTimeout(c),void 0!==e&&n.setTitle(e),e=void 0,t=void 0},v=function(){u?(n.getTitle()===e?n.setTitle(t):n.setTitle(e),c=setTimeout(v,f)):m()},w=function(i,o){f=void 0===o?1e3:o,u&&void 0===e&&(t=i,e=n.getTitle(),v())},T=function(i,n,t,e){if(u&&d()-s>o.notifications.maxOnePerMs)if(void 0===e&&(e=!1),a&&"granted"===Notification.permission){var c=new Notification(i,{body:n,icon:t});c.onshow=function(){setTimeout(function(){c.close()},3e3)},s=d()}else e&&w("Attention",1e3)};a=void 0!==window.Notification,i.on("notification:send",function(i){T(i.title,i.body,i.icon,!0)}),i.on("notification:on",function(){r()}),i.on("notification:off",function(){l()}),function(){a&&"denied"!==Notification.permission&&Notification.requestPermission(function(i){Notification.permission=i})}(),l(),s=d(),m()});