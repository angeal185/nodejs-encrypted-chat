define(["$","castrato","settings","templates"],function(o,e,m,t){var n=!1,a=function(a){!1!==n?e.emit("console:error",o.template(t.messages.already_in_room,{room:n})):a.length>=m.room.maxLen?e.emit("console:error",o.template(t.messages.room_name_too_long)):a.length<m.room.minLen?e.emit("console:error",o.template(t.messages.room_name_too_short)):(n=a,e.emit("room:changed",n).emit("socket:emit",{data:"room:join",payload:o.SHA1(n)}))},r=function(){!1!==n?(e.emit("socket:emit",{data:"room:leave",payload:o.SHA1(n)}),n=!1):e.emit("console:error",t.messages.leave_from_nowhere)},s=function(){n?e.emit("socket:emit",{data:"room:count"}):e.emit("console:error",t.messages.not_in_room)};e.on("command:join",a),e.on("command:leave",r),e.on("command:count",s)});